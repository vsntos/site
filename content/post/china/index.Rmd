---
title: "A China na América do Sul"
author: "Vinicius Santos"
date: '2020-12-18'
slug: []
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2020-12-18T21:37:49Z'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

```{r setup, include=FALSE}
base::set.seed(42)
base::options(
  scipen = 999,
  knitr.kable.NA = " - "
  )
knitr::opts_chunk$set(
  cache.extra = knitr::rand_seed, 
  message = FALSE, 
  warning = FALSE, 
  error = FALSE, 
  echo = TRUE,
  fig.retina = 3
  )
```

## Introdução

Objetivo: analisar o tamanho e características empréstimos e subsídios Chineses, notadamente, na América do Sul entre 2000 - 2014.

Desafio: we find that 50% of China’s lending to developing countries is not reported to the IMF or World Bank. (HORN; REINHART.; TREBESCH, 2015:7).

## Coleta e Análise dos Dados

Dreher, A., Fuchs, A., Parks, B.C., Strange, A. M., & Tierney, M. J. (2017). Aid, China, and Growth: Evidence from a New Global Development Finance Dataset. AidData Working Paper #46. Williamsburg, VA: AidData.

"This dataset tracks the known universe of overseas Chinese official finance including foreign aid and other forms of concessional and non-concessional state financing — from China to 138 countries between 2000 and 2014.

Apresentaremos os dados sob a forma de *estatística descritiva* e mobilizaremos algumas medidas de *Análise de Redes*.


First, let's load the packages:

```{r libraries}
library(dplyr)
library(ggplot2)
library(tidyverse)
library(readr)
library(dplyr)
library(GGally)
library(splitstackshape)
library(readxl)
library(ggplot2)
library(here)
library(ggrepel)
library(ggridges)
library(gganimate)
library(ggstance)
library(patchwork)
library(igraph)
library(plotly)
library(reshape2)
library(visNetwork)
library(DT)
```

Then, let's read some data taken from student's references section. To make it easy in this post, the data are already saved in a .csv file but you will find my procedure to obtain this table here below commented:

```{r data}

dados_cross_bid <- here("static/files/dados.cross.csv") %>% 
  read_csv()

dados_GCOF <- here("static/files/GlobalChineseOfficialFinanceDataset_v1.0.xlsx") %>% 
  read_xlsx()

```

```{r include=FALSE}
dados_cross_bid <- cSplit(dados_cross_bid, 'Approval Date', sep="-", type.convert=FALSE)

dados_GCOF <- cSplit(dados_GCOF, 'funding_agency', sep=",", type.convert=FALSE)

dados_GCOF <- cSplit(dados_GCOF, 'recipient_oecd_name', sep=";", type.convert=FALSE)

dados_GCOF <- cSplit(dados_GCOF, 'implementing_agency', sep=",", type.convert=FALSE)

```


Do total das 5466 observações salienta-se que 4235 projetos (77.48%) não tem identificação da origem do financiamento sob o rótulo *Unspecified Chinese Government Institution*. No entanto, dos projetos que a origem dos recursos podem ser identificados três stakeholders podem ser destacados: Export-Import Bank of China (765), China Development Bank (208), e Chinese Embassy/Consulate (71). O gráfico 1 apresenta o conjunto de entidades que financiaram acima de 5 projetos.


```{r echo=FALSE}
#, fig.width=10, fig.height=10, fig.align='center'

t <-table(dados_GCOF$funding_agency_1)
t <- as.data.frame(t)

t1 <- t %>% 
  filter(Freq %in% (5:765))

t1 %>% 
mutate(Var1 = fct_reorder(Var1, Freq)) %>%
ggplot() +
 aes(x = Var1, weight = Freq) +
 geom_bar(fill = "#0c4c8a") +
 coord_flip() +
 labs(x = " ", y = "Número de projetos", title = "Número de projetos por agencia financiadora", caption = "Elaborado pelo autor. Fonte: Global Chinese Official Finance Dataset") +
 theme_classic(base_size = 10)

```


A mesm dificuldade de rastreamento ocorre para a identificação dos implementadores sendo possível nomeá-los em apenas 1409 projetos. O Gráfico 2 apresenta esses resultados. 

```{r}

t2 <-table(dados_GCOF$implementing_agency_1)
t2 <- as.data.frame(t2)

t2 <- t2 %>% 
  filter(Freq %in% (10:765))

t2 %>% 
mutate(Var1 = fct_reorder(Var1, Freq)) %>%
ggplot() +
 aes(x = Var1, weight = Freq) +
 geom_bar(fill = "#0c4c8a") +
 coord_flip() +
 labs(x = " ", y = "Número de projetos ", title = "Número de projetos por implementadores", caption = "Elaborado pelo autor. Fonte: Global Chinese Official Finance Dataset") +
 theme_classic(base_size = 10)

```


Cabe considerar que, consideradas apenas as operações sem identificação de financiamento, ao rastrear os stakeholders implementadores dos projetos destacamos: i) Confucius Institute (31), ii) Shanghai Construction Group General Co (22) e iii) Chinese Embassy (20). A tabela 1 informa quais atores que mais implementaram projetos na categoria dos financiamentos não passíveis de rastreamento.

```{r echo=FALSE}

t3 <- dados_GCOF %>% 
  filter(funding_agency_1 == "Unspecified Chinese Government Institution") %>% # apenas os financiamentos não identificados
  select(implementing_agency_1) # apenas a coluna de stk que implementaram

t4 <-table(t3)

t4 <- as.data.frame(t4)

datatable(t4)

```


440 dos 5466 projetos tiveram a a "Latin America and the Caribbean" como destido. Abaixo a distribuição o anual dos projetos na região

```{r echo=FALSE, message=FALSE, warning=FALSE}

## Região ##

p1 <- dados_GCOF %>%
 filter(recipient_region %in% "Latin America and the Caribbean") %>%
 ggplot() +
 aes(x = year, fill = sector) +
 geom_histogram(bins = 57L) +
 labs(x = " ", y = "", title = "Número de projetos por ano e setor", caption = "Elaborado pelo autor. Fonte: Global Chinese Official Finance Dataset") +
 scale_fill_hue() +
 theme_classic(base_size = 10) +
 facet_wrap(vars(recipient_region))

ggplotly(p1)

```


Sobre a distribuição dos projetos por países setores na região "Latin America and the Caribbean" 


```{r}

tab1 <- cbind(dados_GCOF$recipient_condensed, dados_GCOF$recipient_region, dados_GCOF$sector)

tab1 <- as.data.frame(tab1)

tab1 <- tab1 %>% 
        filter(V2 %in% "Latin America and the Caribbean")
 
tab1.tab <- table(tab1)

tab1.tab <- as.data.frame(tab1.tab)

cc1 <- ggplot(tab1) +
 aes(x = V1) +
 geom_bar() +
 scale_fill_hue() +
 coord_flip() +
 theme_minimal()


cc2 <- ggplot(tab1) +
  aes(x = V1, fill = V3) +
  geom_bar(position = "fill") +
  scale_fill_hue() +
  coord_flip() +
  theme_minimal()

cc1 / cc2
```



## Análise de Redes: Financiadores e Implementadores

Quais nós tem um maior impacto na determinação da estrutura da rede?

A primeira rede a ser apresentada é a que vincula entidades financiadoras e países que receberam o financiamento. A rede é composta por 168 nós e 1229 vínculos.

```{r}
 nodes <- here("static/files/Nodeset.xlsx") %>% 
  read_xlsx()
 edges <- here("static/files/Edgelist.xlsx") %>% 
 read_xlsx()
 
```


```{r}
g <- graph_from_data_frame(edges)

```


```{r echo=FALSE, message=FALSE, warning=FALSE}
visNetwork(nodes, edges, width = "100%", main = "Rede de Financiamento") %>% # https://rdrr.io/cran/visNetwork/man/visNetwork.html
  visOptions(width = "200%", height = "190%",
             highlightNearest = list(enabled = TRUE, degree = 1, hover = TRUE),
             nodesIdSelection = list(enabled = TRUE)) %>%
  visInteraction(hover = TRUE, navigationButtons = F) %>%
  visNodes(shapeProperties = list(useBorderWithImage = TRUE)) %>%
  visPhysics(solver = "barnesHut") %>% 
  visOptions(manipulation = TRUE) %>%
  visGroups()
```

```{r message=FALSE, warning=FALSE}

indegree <- degree(g, mode = "in")
outdegree <- degree(g, mode = "out")
incloseness <- closeness(g, mode = "in") %>% round(6)
outcloseness <- closeness(g, mode = "out") %>% round(6)
betweenness <- betweenness(g) %>% round(1)
eigenvector <- eigen_centrality(g, directed = FALSE) %$% vector %>% round(3)

df_sna <- data.frame(indegree, outdegree, incloseness, outcloseness, betweenness, eigenvector)

```


```{r}
datatable(df_sna)

```


```{r eval=FALSE, include=FALSE}
 sub_base <- dados_GCOF %>%
   select(funding_agency_1, recipient_oecd_name_01, sector, project_id, year, recipient_region) %>% 
   filter(recipient_region == "Latin America and the Caribbean") %>% 
   rename(from = funding_agency_1, to = recipient_oecd_name_01)

#rede
 
 relations <- sub_base %>% 
   select(from, to)
 
relations <- data.frame(relations)

g <- graph_from_data_frame(sub_base)

```

```{r eval=FALSE, include=FALSE}

# Rede interativa. Ref: http://sillasgonzaga.com/post/meta-analise-r-02/

visIgraph(g, physics = T, smooth = TRUE, type = "full", randomSeed = 123) %>%
  visOptions(width = "200%", height = "190%",
             highlightNearest = list(enabled = TRUE, degree = 1, hover = TRUE),
             nodesIdSelection = list(enabled = TRUE)) %>%
  visInteraction(hover = TRUE, navigationButtons = F) %>%
  visPhysics(solver = "barnesHut", 
  forceAtlas2Based = list(gravitationalConstant = -13500)) %>% 
  visOptions(manipulation = TRUE) %>%
  visGroups()

```


```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

# dados de Rede - Financiadores

indegree <- degree(g, mode = "in")
outdegree <- degree(g, mode = "out")
incloseness <- closeness(g, mode = "in") %>% round(6)
outcloseness <- closeness(g, mode = "out") %>% round(6)
betweenness <- betweenness(g) %>% round(1)
eigenvector <- eigen_centrality(g, directed = FALSE) %$% vector %>% round(3)

df_sna <- data.frame(indegree, outdegree, incloseness, outcloseness, betweenness, eigenvector)

```


```{r eval=FALSE, include=FALSE}
# criar tabela interativa com pacote DT
datatable(df_sna)
```


## Considerações Finais


Do ponto de vista topológico:

  a. Rede de financiadores
    
Considerando as operações que são possíveis de serem rastreadas, os resultados sugerem que há uma alta centralização de, notadamente, três stakeholders: i) Export-Import Bank of China, ii) China Development Bank (CDB), iii) Chinese Embassy/Consulate. Cabe considerar que, até onde conseguimos verificar, essa estrututura torna esse sistema pouco resiliente na medida em que a saída de poucos nós pode gerar um impacto sistêmico significativo (passível de ser medido).

  b. Já em relação aos implementadores:

A rede tem uma topologia mais descentralizada tendo entre os 4 principais nós 3 empreas relacionadas a infraestrtutura e uma de tecnologia. 

## Referências

Horn, Sebastian; Reinhart, Carmen M.; Trebesch, Christoph (2019).
[China's overseas lending](https://www.econstor.eu/bitstream/10419/200198/1/1668908891.pdf), Kiel Working Paper, No. 2132, Kiel Institute for the World Economy
(IfW), Kiel.

Dreher, A., Fuchs, A., Parks, B.C., Strange, A. M., & Tierney, M. J. (2017). Aid, China, and Growth: Evidence from a New Global Development Finance Dataset. AidData Working Paper #46. Williamsburg, VA: [AidData.](https://www.aiddata.org/data/chinese-global-official-finance-dataset).
